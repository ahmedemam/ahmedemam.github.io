<!DOCTYPE html>
<html lang="en-us">

  {% include head.html %}

  <body class="theme-base-{{site.color-scheme}}">

    {% include top-nav.html %}

    <div class="app-layout">
      {% include left-sidebar.html %}
      
      <main class="main-content" id="main" role="main">
        <div class="main-content-wrapper">
          {% unless page.url == '/' or page.url == '/index.html' %}
          <nav class="breadcrumbs" aria-label="Breadcrumb">
            <a href="{{ site.baseurl }}/">Home</a>
            <span> / </span>
            <span>{{ page.title }}</span>
          </nav>
          {% endunless %}
          
          {% unless page.url == '/' or page.url == '/index.html' %}
          <div class="page-header">
            <div class="page-header-top">
              <h1 class="page-title">{{ page.title }}</h1>
              <button class="copy-page-button" aria-label="Copy page" title="Copy page">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
              </button>
            </div>
            {% if page.date %}
            <p class="page-meta">Last updated {{ page.date | date: "%B %d, %Y" }}</p>
            {% elsif page.show_reading_time != false %}
            <p class="page-meta">
              {% include reading-time.html %}
            </p>
            {% endif %}
          </div>
          {% endunless %}

          <div id="loading-indicator" class="loading-indicator" style="display: none;">
            <div class="loading-spinner"></div>
          </div>
          
          <div class="content">
            {{ content }}
          </div>
        </div>
      </main>
      
      {% include right-sidebar.html %}
    </div>
    
    <!-- Scroll to top button -->
    <button id="scroll-to-top" class="scroll-to-top" aria-label="Scroll to top" style="display: none;">
      â†‘
    </button>

    <script>

    // Highlight search Query
    var url = window.location.href;
      if (url.lastIndexOf("?q=") > 0) {
        // get the index of the parameter, add three (to account for length)
        var stringloc = url.lastIndexOf("?q=") + 3;
        // get the substring (query) and decode
        var searchquery = decodeURIComponent(url.substr(stringloc));
        // regex matches at beginning of line, end of line or word boundary, useful for poetry
        var regex = new RegExp("(?:^|\\b)(" + searchquery + ")(?:$|\\b)", "gim");
        // get, add mark and then set content
        var content = document.getElementById("main").innerHTML;
        document.getElementById("main").innerHTML = content.replace(regex, "<mark>$1</mark>");
      }


    <!-- AJAX Navigation for Internal Links -->
    <script>
      (function() {
        // Get base URL
        var baseUrl = '{{ site.baseurl }}' || '';
        var siteUrl = '{{ site.url }}' || window.location.origin;
        
        // Function to check if link is external
        function isExternalLink(url) {
          if (!url || url === '#' || url.startsWith('mailto:') || url.startsWith('javascript:')) {
            return false;
          }
          // External domains that should open in new tabs
          var externalDomains = [
            'cremeglobal.com',
            'masteryhub-its.com',
            'jsrspaces.com',
            'wepray.us',
            'speakout.icu',
            'squadxcamp.com',
            'linkedin.com',
            'github.com',
            'food.jumia.com.eg',
            'cloudypedia.com',
            'beyond-solution.com',
            'orange.com'
          ];
          
          // Check if URL contains any external domain
          for (var i = 0; i < externalDomains.length; i++) {
            if (url.indexOf(externalDomains[i]) !== -1) {
              return true;
            }
          }
          
          // Check if it's an absolute URL to a different domain
          if (url.startsWith('http://') || url.startsWith('https://')) {
            try {
              var linkHost = new URL(url).hostname;
              var currentHost = window.location.hostname;
              return linkHost !== currentHost && linkHost !== 'ahmedemam.github.io';
            } catch(e) {
              return true;
            }
          }
          
          return false;
        }
        
        // Function to check if link is internal
        function isInternalLink(url) {
          if (!url || url === '#' || url.startsWith('mailto:') || url.startsWith('javascript:')) {
            return false;
          }
          
          // If it's an external link, it's not internal
          if (isExternalLink(url)) {
            return false;
          }
          
          // Internal links: relative paths or same domain
          if (url.startsWith('/') || url.startsWith('./') || url.startsWith('../')) {
            return true;
          }
          
          // Check if it's same domain
          try {
            var linkUrl = new URL(url, window.location.href);
            return linkUrl.hostname === window.location.hostname || 
                   linkUrl.hostname === 'ahmedemam.github.io';
          } catch(e) {
            // If URL parsing fails, assume it's relative/internal
            return !url.startsWith('http://') && !url.startsWith('https://');
          }
        }
        
        // Function to load page content via AJAX
        function loadPage(url) {
          // Update URL without reload
          if (window.history && window.history.pushState) {
            window.history.pushState({path: url}, '', url);
          }
          
          // Show loading indicator
          var loadingIndicator = document.getElementById('loading-indicator');
          if (loadingIndicator) {
            loadingIndicator.style.display = 'block';
          }
          
          // Show loading state
          var main = document.getElementById('main');
          if (main) {
            main.style.opacity = '0.5';
            main.style.transition = 'opacity 0.3s ease';
          }
          
          // Fetch the page
          fetch(url)
            .then(function(response) {
              return response.text();
            })
            .then(function(html) {
              // Parse the HTML
              var parser = new DOMParser();
              var doc = parser.parseFromString(html, 'text/html');
              
              // Extract the main content
              var newMain = doc.getElementById('main');
              if (newMain && main) {
                // Update content
                main.innerHTML = newMain.innerHTML;
                
                // Update page title
                var newTitle = doc.querySelector('title');
                if (newTitle) {
                  document.title = newTitle.textContent;
                }
                
                // Hide loading indicator
                if (loadingIndicator) {
                  loadingIndicator.style.display = 'none';
                }
                
                // Fade in
                main.style.opacity = '1';
                
                // Scroll to top
                window.scrollTo(0, 0);
                
                // Re-initialize any scripts if needed
                if (typeof window.umami !== 'undefined') {
                  window.umami.trackView();
                }
              }
            })
            .catch(function(error) {
              console.error('Error loading page:', error);
              // Hide loading indicator
              if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
              }
              // Fallback to normal navigation
              window.location.href = url;
            });
        }
        
        // Handle popstate (back/forward buttons)
        window.addEventListener('popstate', function(event) {
          if (event.state && event.state.path) {
            loadPage(event.state.path);
          } else {
            window.location.reload();
          }
        });
        
        // Intercept link clicks
        document.addEventListener('click', function(e) {
          var link = e.target.closest('a');
          if (!link) return;
          
          var href = link.getAttribute('href');
          if (!href) return;
          
          // Skip if it has target="_blank" or is external
          if (link.getAttribute('target') === '_blank' || isExternalLink(href)) {
            return; // Let it open normally
          }
          
          // Skip if it's a mailto or javascript link
          if (href.startsWith('mailto:') || href.startsWith('javascript:')) {
            return;
          }
          
          // Check if it's an internal link
          if (isInternalLink(href)) {
            e.preventDefault();
            
            // Convert relative URL to absolute
            var absoluteUrl = href;
            if (href.startsWith('/')) {
              absoluteUrl = window.location.origin + href;
            } else if (!href.startsWith('http://') && !href.startsWith('https://')) {
              absoluteUrl = new URL(href, window.location.href).href;
            }
            
            loadPage(absoluteUrl);
          }
        });
      })();
    </script>

    <!-- Scroll to Top Button -->
    <script>
      (function() {
        var scrollButton = document.getElementById('scroll-to-top');
        if (!scrollButton) return;
        
        // Show/hide button based on scroll position
        function toggleScrollButton() {
          if (window.pageYOffset > 300) {
            scrollButton.style.display = 'block';
          } else {
            scrollButton.style.display = 'none';
          }
        }
        
        // Scroll to top on click
        scrollButton.addEventListener('click', function() {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
        
        // Show/hide on scroll
        window.addEventListener('scroll', toggleScrollButton);
        toggleScrollButton(); // Check initial state
      })();
    </script>

    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('{{ site.baseurl }}/sw.js')
            .then(function(registration) {
              console.log('ServiceWorker registration successful');
            })
            .catch(function(err) {
              console.log('ServiceWorker registration failed');
            });
        });
      }
    </script>

<!-- Facebook SDK for JavaScript -->
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '589495744558280',
      xfbml      : true,
      version    : 'v2.6'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

    <!-- Theme Toggle -->
    <script>
      (function() {
        const toggleBtn = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-icon-light');
        const darkIcon = document.getElementById('theme-icon-dark');
        const html = document.documentElement;

        // Check preference - Default to Light (like Next.js docs)
        const currentTheme = localStorage.getItem('theme') || 'light';

        if (currentTheme === 'dark') {
          html.setAttribute('data-theme', 'dark');
          if (lightIcon) lightIcon.style.display = 'none';
          if (darkIcon) darkIcon.style.display = 'block';
        } else {
          html.removeAttribute('data-theme');
          if (lightIcon) lightIcon.style.display = 'block';
          if (darkIcon) darkIcon.style.display = 'none';
        }

        if (toggleBtn) {
          toggleBtn.addEventListener('click', function() {
            if (html.getAttribute('data-theme') === 'dark') {
              html.removeAttribute('data-theme');
              localStorage.setItem('theme', 'light');
              if (lightIcon) lightIcon.style.display = 'block';
              if (darkIcon) darkIcon.style.display = 'none';
            } else {
              html.setAttribute('data-theme', 'dark');
              localStorage.setItem('theme', 'dark');
              if (lightIcon) lightIcon.style.display = 'none';
              if (darkIcon) darkIcon.style.display = 'block';
            }
          });
        }
      })();
    </script>

    <!-- Auto-generate Table of Contents -->
    <script>
      (function() {
        const rightSidebar = document.getElementById('right-sidebar');
        if (!rightSidebar) return;

        const tocPlaceholder = document.getElementById('toc-placeholder');
        const tocNav = rightSidebar.querySelector('.right-sidebar-nav');
        if (!tocNav) return;

        // Get all headings in the content
        const content = document.querySelector('.content');
        if (!content) return;

        const headings = content.querySelectorAll('h2, h3');
        if (headings.length === 0) {
          if (tocPlaceholder) tocPlaceholder.textContent = 'No headings found';
          return;
        }

        // Remove placeholder
        if (tocPlaceholder) {
          tocPlaceholder.remove();
        }

        // Generate TOC
        headings.forEach(function(heading) {
          // Generate ID if not present
          if (!heading.id) {
            heading.id = heading.textContent.toLowerCase()
              .replace(/[^a-z0-9]+/g, '-')
              .replace(/^-|-$/g, '');
          }

          // Create TOC item
          const tocItem = document.createElement('a');
          tocItem.className = 'right-sidebar-nav-item';
          tocItem.href = '#' + heading.id;
          tocItem.textContent = heading.textContent;
          
          // Add indentation for h3
          if (heading.tagName === 'H3') {
            tocItem.style.paddingLeft = '1.5rem';
            tocItem.style.fontSize = '0.8125rem';
          }

          tocNav.appendChild(tocItem);
        });

        // Highlight active TOC item on scroll
        const tocItems = tocNav.querySelectorAll('.right-sidebar-nav-item');
        const observerOptions = {
          rootMargin: '-20% 0% -70% 0%',
          threshold: 0
        };

        const observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            const id = entry.target.id;
            const tocItem = tocNav.querySelector('a[href="#' + id + '"]');
            
            if (entry.isIntersecting) {
              tocItems.forEach(function(item) {
                item.classList.remove('active');
              });
              if (tocItem) {
                tocItem.classList.add('active');
              }
            }
          });
        }, observerOptions);

        headings.forEach(function(heading) {
          observer.observe(heading);
        });
      })();
    </script>

    <!-- Copy Page Button -->
    <script>
      (function() {
        const copyButton = document.querySelector('.copy-page-button');
        if (!copyButton) return;

        copyButton.addEventListener('click', function() {
          const url = window.location.href;
          navigator.clipboard.writeText(url).then(function() {
            const originalHTML = copyButton.innerHTML;
            copyButton.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            setTimeout(function() {
              copyButton.innerHTML = originalHTML;
            }, 2000);
          });
        });
      })();
    </script>

    <!-- Search Functionality -->
    <script>
      (function() {
        const searchInput = document.getElementById('top-nav-search-input');
        if (!searchInput) return;

        // Focus search on Ctrl+K
        document.addEventListener('keydown', function(e) {
          if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            searchInput.focus();
          }
        });

        // Simple search - redirect to search page
        searchInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            const query = searchInput.value.trim();
            if (query) {
              window.location.href = '{{ site.baseurl }}/search.html?q=' + encodeURIComponent(query);
            }
          }
        });
      })();
    </script>
  </body>
</html>
